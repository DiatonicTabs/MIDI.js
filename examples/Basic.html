<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8"/>

		<!-- shims -->
		<script src="../inc/shim/Base64.js"></script>
		<script src="../inc/shim/WebAudioAPI.js"></script>
		<script src="../inc/shim/WebMIDIAPI.js"></script>

		<!-- utils -->
		<script src="../inc/dom/request_script.js"></script>
		<script src="../inc/dom/request_xhr.js"></script>
		<script src="../inc/EventEmitter.js"></script>

		<script src="../build/MIDI.js"></script>

	</head>
	<body>
		<script>

			window.onload = function () {
				MIDI.startDebugging()
				MIDI.WebAudioSM.connect()
				MIDI.autoselectFormat()
				MIDI.setChannels(16)

				MIDI.onProgress = function (state, progress) {
					console.log('Loading:', progress.toFixed(2), '%')
				}

				MIDI.loadProgram({
					intoSlot: 0,
					filename: './soundfont/acoustic_grand_piano-%FORMAT.json'
				}).then(function () {
					const note = 50
					const velocity = 127

					MIDI.noteOn(0, note, velocity)
					MIDI.noteOn(0, note + 2, velocity, 0.1)
					MIDI.noteOn(0, note + 3, velocity, 0.2)
					MIDI.noteOn(0, note + 4, velocity, 0.3)
					MIDI.noteOff(0, note, 0.75)
					MIDI.noteOff(0, note + 2, 0.75)
					MIDI.noteOff(0, note + 3, 0.75)
					MIDI.noteOff(0, note + 4, 0.75)
				})
			}

		</script>
	</body>
</html>