<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8"/>

		<!-- shims -->
		<script src="../inc/shim/Base64.js"></script>
		<script src="../inc/shim/WebAudioAPI.js"></script>
		<script src="../inc/shim/WebMIDIAPI.js"></script>

		<!-- utils -->
		<script src="../inc/dom/request_script.js"></script>
		<script src="../inc/dom/request_xhr.js"></script>
		<script src="../inc/EventEmitter.js"></script>

		<script src="../build/MIDI.js"></script>

	</head>
	<body>
		<script>

			window.onload = function () {
				MIDI.startDebugging()
				MIDI.webaudio.connect()
				MIDI.autoselectFormat()
				MIDI.setChannels(16)

				MIDI.onProgress = function (state, progress) {
					console.log('Loading:', progress.toFixed(2), '%')
				}

				Promise.all([
					MIDI.loadProgram({
						intoSlot: 0,
						filename: './soundfont/acoustic_grand_piano-%FORMAT.json'
					}),
					MIDI.loadProgram({
						intoSlot: 10,
						filename: './soundfont/synth_drum-%FORMAT.json'
					})
				]).then(function () {
					const piano = 50
					const drum = 21
					const velocity = 127

					MIDI.channels[0].programID = 10
					MIDI.channels[1].volume = 50
					for (let i = 0; i < 8; i += 1) {
						MIDI.noteOn(0, drum + (8 - i), velocity, 0.2 * i)
						MIDI.noteOff(0, drum + (8 - i), 0.2 * 8)

						MIDI.noteOn(1, piano + i, velocity, 0.2 * i)
						MIDI.noteOff(1, piano + i, 0.2 * 8)
					}
				})
			}

		</script>
	</body>
</html>